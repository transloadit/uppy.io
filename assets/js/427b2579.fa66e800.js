"use strict";(self.webpackChunkuppy_io=self.webpackChunkuppy_io||[]).push([[7873],{41649:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>l,frontMatter:()=>s,metadata:()=>i,toc:()=>u});var r=n(74848),o=n(28453);const s={slug:"/reactrouter"},a="React Router",i={id:"framework-integrations/react-router",title:"React Router",description:"Integration guide for the React components for the Uppy UI plugins and",source:"@site/docs/framework-integrations/react-router.mdx",sourceDirName:"framework-integrations",slug:"/reactrouter",permalink:"/docs/reactrouter",draft:!1,unlisted:!1,editUrl:"https://github.com/transloadit/uppy.io/blob/main/docs/framework-integrations/react-router.mdx",tags:[],version:"current",frontMatter:{slug:"/reactrouter"},sidebar:"tutorialSidebar",previous:{title:"Next.js",permalink:"/docs/nextjs"},next:{title:"React",permalink:"/docs/react"}},c={},u=[{value:"Install",id:"install",level:2},{value:"Tus",id:"tus",level:2},{value:"Transloadit",id:"transloadit",level:2},{value:"HTTP uploads to your backend",id:"http-uploads-to-your-backend",level:2},{value:"Next steps",id:"next-steps",level:2}];function p(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h1,{id:"react-router",children:"React Router"}),"\n",(0,r.jsxs)(t.p,{children:["Integration guide for the ",(0,r.jsx)(t.a,{href:"https://facebook.github.io/react",children:"React"})," components for the Uppy UI plugins and\nhooks."]}),"\n",(0,r.jsx)(t.admonition,{type:"tip",children:(0,r.jsxs)(t.p,{children:["Uppy also has hooks and more React examples in the ",(0,r.jsx)(t.a,{href:"/docs/react",children:"React docs"}),"."]})}),"\n",(0,r.jsx)(t.h2,{id:"install",children:"Install"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:"npm install @uppy/core @uppy/dashboard @uppy/react\n"})}),"\n",(0,r.jsx)(t.h2,{id:"tus",children:"Tus"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.a,{href:"https://tus.io/",children:"Tus"})," is an open protocol for resumable uploads built on HTTP. This means\naccidentally closing your tab or losing connection lets you continue, for\ninstance, your 10GB upload instead of starting all over."]}),"\n",(0,r.jsxs)(t.p,{children:["Tus supports any language, any platform, and any network. It requires a client\nand server integration to work. We will be using ",(0,r.jsx)(t.a,{href:"https://github.com/tus/tus-node-server",children:"tus Node.js"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["Checkout the ",(0,r.jsxs)(t.a,{href:"/docs/tus",children:[(0,r.jsx)(t.code,{children:"@uppy/tus"})," docs"]})," for more information."]}),"\n",(0,r.jsx)(t.p,{children:"Create a route where you want to handle uploads:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-tsx",children:"import { useEffect, useState } from 'react';\nimport Uppy from '@uppy/core';\nimport Dashboard from '@uppy/react/lib/Dashboard';\nimport Tus from '@uppy/tus';\n\nimport '@uppy/core/css/style.min.css';\nimport '@uppy/dashboard/css/style.min.css';\n\nfunction createUppy() {\n\treturn new Uppy().use(Tus, { endpoint: '/api/upload' });\n}\n\nexport default function UppyDashboard() {\n\t// Important: use an initializer function to prevent the state from recreating.\n\tconst [uppy] = useState(createUppy);\n\n\treturn <Dashboard theme=\"dark\" uppy={uppy} />;\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.a,{href:"https://github.com/tus/tus-node-server",children:(0,r.jsx)(t.code,{children:"@tus/server"})})," does not support react router resource routes yet,\nwhich is based on the fetch ",(0,r.jsx)(t.code,{children:"Request"})," API instead of ",(0,r.jsx)(t.code,{children:"http.IncomingMessage"})," and\n",(0,r.jsx)(t.code,{children:"http.ServerResponse"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["However we can workaround it by using a custom server, which is a common pattern\nwith React Router. The ",(0,r.jsx)(t.a,{href:"https://remix.run/docs/en/main/other-api/adapter",children:"docs"}),"\nfor this are still on the Remix site, but the same packages exist under the\n",(0,r.jsx)(t.code,{children:"@react-router/*"})," scope."]}),"\n",(0,r.jsxs)(t.p,{children:["The exact code to integrate ",(0,r.jsx)(t.a,{href:"https://github.com/tus/tus-node-server",children:"tus Node.js"})," in your custom server depends on the\nframework you choose. Head over to the ",(0,r.jsx)(t.code,{children:"@tus/server"})," ",(0,r.jsx)(t.a,{href:"https://github.com/tus/tus-node-server/tree/main/packages/server#examples",children:"examples for the most popular Node.js servers"}),"\nto find the one that works for you."]}),"\n",(0,r.jsx)(t.h2,{id:"transloadit",children:"Transloadit"}),"\n",(0,r.jsx)(t.admonition,{type:"note",children:(0,r.jsxs)(t.p,{children:["Before continuing you should have a ",(0,r.jsx)(t.a,{href:"https://transloadit.com",children:"Transloadit"}),"\naccount and a\n",(0,r.jsx)(t.a,{href:"https://transloadit.com/docs/getting-started/my-first-app/",children:"template"})," setup."]})}),"\n",(0,r.jsxs)(t.p,{children:["Transloadit\u2019s strength is versatility. By doing video, audio, images, documents,\nand more, you only need one vendor for ",(0,r.jsx)(t.a,{href:"https://transloadit.com/services/",children:"all your file processing\nneeds"}),". The ",(0,r.jsx)(t.a,{href:"/docs/transloadit",children:(0,r.jsx)(t.code,{children:"@uppy/transloadit"})}),"\nplugin directly uploads to Transloadit so you only have to worry about creating\na ",(0,r.jsx)(t.a,{href:"https://transloadit.com/docs/getting-started/concepts/",children:"template"}),". It uses ",(0,r.jsx)(t.a,{href:"#tus",children:"Tus"})," under the hood so you\ndon\u2019t have to sacrifice reliable, resumable uploads for convenience."]}),"\n",(0,r.jsxs)(t.p,{children:["When you go to production always make sure to set the ",(0,r.jsx)(t.code,{children:"signature"}),". ",(0,r.jsxs)(t.strong,{children:["Not using\n",(0,r.jsx)(t.a,{href:"https://transloadit.com/docs/topics/signature-authentication/",children:"Signature Authentication"}),"\ncan be a security risk"]}),". Signature Authentication is a security measure that\ncan prevent outsiders from tampering with your Assembly Instructions."]}),"\n",(0,r.jsx)(t.p,{children:"Generating a signature should be done on the server to avoid leaking secrets."}),"\n",(0,r.jsxs)(t.p,{children:["Start by creating a\n",(0,r.jsx)(t.a,{href:"https://reactrouter.com/how-to/resource-routes",children:"resource route"})," to generate the\nsignature and params:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:"import { data } from 'react-router';\nimport type { ActionFunction } from 'react-router';\nimport crypto from 'crypto';\n\nfunction utcDateString(ms: number): string {\n\treturn new Date(ms)\n\t\t.toISOString()\n\t\t.replace(/-/g, '/')\n\t\t.replace(/T/, ' ')\n\t\t.replace(/\\.\\d+Z$/, '+00:00');\n}\n\nexport const action: ActionFunction = async ({ request }) => {\n\t// expire 1 hour from now (this must be milliseconds)\n\tconst expires = utcDateString(Date.now() + 1 * 60 * 60 * 1000);\n\tconst authKey = process.env.TRANSLOADIT_KEY;\n\tconst authSecret = process.env.TRANSLOADIT_SECRET;\n\tconst templateId = process.env.TRANSLOADIT_TEMPLATE_ID;\n\n\tif (!authKey || !authSecret || !templateId) {\n\t\tthrow data({ error: 'Missing Transloadit credentials' }, { status: 500 });\n\t}\n\n\tconst body = await request.json();\n\tconst params = JSON.stringify({\n\t\tauth: {\n\t\t\tkey: authKey,\n\t\t\texpires,\n\t\t},\n\t\ttemplate_id: templateId,\n\t\tfields: {\n\t\t\t// You can use this in your template.\n\t\t\tcustomValue: body.customValue,\n\t\t},\n\t\t// your other params like notify_url, etc.\n\t});\n\n\tconst signatureBytes = crypto\n\t\t.createHmac('sha384', authSecret)\n\t\t.update(Buffer.from(params, 'utf-8'));\n\t// The final signature needs the hash name in front, so\n\t// the hashing algorithm can be updated in a backwards-compatible\n\t// way when old algorithms become insecure.\n\tconst signature = `sha384:${signatureBytes.digest('hex')}`;\n\n\treturn data({ expires, signature, params });\n};\n"})}),"\n",(0,r.jsxs)(t.p,{children:["On the client we want to fetch the signature and params from the server. You may\nwant to send values from React state along to your endpoint, for instance to add\n",(0,r.jsx)(t.a,{href:"https://transloadit.com/docs/topics/assembly-variables/",children:(0,r.jsx)(t.code,{children:"fields"})})," which you\ncan use in your template as global variables."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-js",children:"// app/routes/upload-transloadit.tsx\nimport { Transloadit } from '@uppy/transloadit';\n\nfunction createUppy() {\n\tconst uppy = new Uppy();\n\tuppy.use(Transloadit, {\n\t\tasync assemblyOptions() {\n\t\t\t// You can send meta data along for use in your template.\n\t\t\t// https://transloadit.com/docs/topics/assembly-instructions/#form-fields-in-instructions\n\t\t\tconst { meta } = uppy.getState();\n\t\t\tconst body = JSON.stringify({ customValue: meta.customValue });\n\t\t\tconst res = await fetch('/transloadit-params', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tbody,\n\t\t\t});\n\t\t\treturn res.json();\n\t\t},\n\t});\n\treturn uppy;\n}\n\nfunction Component({ customValue }) {\n\t// IMPORTANT: passing an initializer function to prevent the state from recreating.\n\tconst [uppy] = useState(createUppy);\n\n\tuseEffect(() => {\n\t\tif (customValue) {\n\t\t\tuppy.setOptions({ meta: { customValue } });\n\t\t}\n\t}, [uppy, customValue]);\n}\n"})}),"\n",(0,r.jsx)(t.h2,{id:"http-uploads-to-your-backend",children:"HTTP uploads to your backend"}),"\n",(0,r.jsxs)(t.p,{children:["If you want to handle uploads yourself, you can use\n",(0,r.jsx)(t.a,{href:"/docs/xhr-upload",children:(0,r.jsx)(t.code,{children:"@uppy/xhr-upload"})}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["Create a ",(0,r.jsx)(t.a,{href:"https://reactrouter.com/how-to/resource-routes",children:"resource route"}),", such\nas ",(0,r.jsx)(t.code,{children:"app/routes/upload/route.ts"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:"import { LocalFileStorage } from '@mjackson/file-storage/local';\nimport { type FileUpload, parseFormData } from '@mjackson/form-data-parser';\nimport { type ActionFunctionArgs } from 'react-router';\n\nconst fileStorage = new LocalFileStorage('./uploads');\n\nexport async function action({ request }: ActionFunctionArgs) {\n\tconst user = requireUser(request); // your optional logic\n\tconst uploadHandler = async (fileUpload: FileUpload) => {\n\t\tconst storageKey = `user-${user.id}-avatar`;\n\t\tawait fileStorage.set(storageKey, fileUpload);\n\t\treturn fileStorage.get(storageKey);\n\t};\n\tconst formData = await parseFormData(request, uploadHandler);\n\tfor (const [key, value] of formData.entries()) {\n\t\tconsole.log(key, value);\n\t}\n\treturn Response.json(null);\n}\n"})}),"\n",(0,r.jsx)(t.p,{children:"Create a page with your Uppy instance:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-tsx",children:"import Uppy from '@uppy/core';\nimport Dashboard from '@uppy/react/lib/Dashboard';\nimport Xhr from '@uppy/xhr-upload';\nimport { useState } from 'react';\n\nimport '@uppy/core/css/style.min.css';\nimport '@uppy/dashboard/css/style.min.css';\n\nfunction createUppy() {\n\treturn new Uppy().use(Xhr, { endpoint: '/upload' });\n}\n\nexport default function UppyDashboard() {\n\t// Important: use an initializer function to prevent the state from recreating.\n\tconst [uppy] = useState(createUppy);\n\n\treturn <Dashboard uppy={uppy} />;\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["If you want to send along other form fields with your upload, you can use\n",(0,r.jsx)(t.a,{href:"/docs/form",children:(0,r.jsx)(t.code,{children:"@uppy/form"})}),"."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-tsx",metastring:"{4,20-23,26-30}",children:"import Uppy from '@uppy/core';\nimport Dashboard from '@uppy/react/lib/Dashboard';\nimport Xhr from '@uppy/xhr-upload';\nimport Form from '@uppy/form';\nimport { useEffect, useState } from 'react';\n\nimport '@uppy/core/css/style.min.css';\nimport '@uppy/dashboard/css/style.min.css';\n\nfunction createUppy() {\n\treturn new Uppy().use(Xhr, { endpoint: '/upload' });\n}\n\nexport default function UppyDashboard() {\n\t// Important: use an initializer function to prevent the state from recreating.\n\tconst [uppy] = useState(createUppy);\n\n\t// @uppy/form is client-side only so we need to install it\n\t// when the component is mounted.\n\tuseEffect(() => {\n\t\tuppy.use(Form, { target: '#form' });\n\t\treturn () => uppy.removePlugin(uppy.getPlugin('Form')!);\n\t}, [uppy]);\n\n\treturn (\n\t\t<form id=\"form\">\n\t\t\t<label htmlFor=\"dob\">Date of birth: </label>\n\t\t\t<input type=\"date\" name=\"dob\" />\n\t\t\t<Dashboard uppy={uppy} />;\n\t\t</form>\n\t);\n}\n"})}),"\n",(0,r.jsx)(t.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["Add client-side file ",(0,r.jsx)(t.a,{href:"/docs/uppy/#restrictions",children:"restrictions"}),"."]}),"\n",(0,r.jsxs)(t.li,{children:["Upload files together with other form fields with ",(0,r.jsx)(t.a,{href:"/docs/form",children:(0,r.jsx)(t.code,{children:"@uppy/form"})}),"."]}),"\n",(0,r.jsxs)(t.li,{children:["Use your ",(0,r.jsx)(t.a,{href:"/docs/locales",children:"language of choice"})," instead of English."]}),"\n",(0,r.jsxs)(t.li,{children:["Add an ",(0,r.jsx)(t.a,{href:"docs/image-editor",children:"image editor"})," for cropping and resizing images."]}),"\n",(0,r.jsxs)(t.li,{children:["Download files from remote sources, such as ",(0,r.jsx)(t.a,{href:"docs/google-drive",children:"Google Drive"}),"\nand ",(0,r.jsx)(t.a,{href:"docs/dropbox",children:"Dropbox"}),", with ",(0,r.jsx)(t.a,{href:"/docs/companion",children:"Companion"}),"."]}),"\n",(0,r.jsxs)(t.li,{children:["Add ",(0,r.jsx)(t.a,{href:"/docs/golden-retriever",children:"Golden Retriever"})," to save selected files in your\nbrowser cache, so that if the browser crashes, or the user accidentally closes\nthe tab, Uppy can restore everything and continue uploading as if nothing\nhappened."]}),"\n"]})]})}function l(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>i});var r=n(96540);const o={},s=r.createContext(o);function a(e){const t=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);
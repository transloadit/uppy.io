<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-companion" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">Companion | Uppy</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:image" content="https://uppy.io/img/og_image.jpg"><meta data-rh="true" name="twitter:image" content="https://uppy.io/img/og_image.jpg"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:url" content="https://uppy.io"><meta data-rh="true" property="og:type" content="website"><meta data-rh="true" name="twitter:card" content="img/og_image.jpg"><meta data-rh="true" name="twitter:domain" content="uppy.io"><meta data-rh="true" name="twitter:url" content="https://uppy.io"><meta data-rh="true" name="twitter:title" content="Uppy"><meta data-rh="true" name="twitter:description" content="Sleek, modular open source JavaScript file uploader"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Companion | Uppy"><meta data-rh="true" name="description" content="Companion is an open source server application which takes away the complexity"><meta data-rh="true" property="og:description" content="Companion is an open source server application which takes away the complexity"><link data-rh="true" rel="icon" href="/img/logo.svg"><link data-rh="true" rel="canonical" href="https://uppy.io/docs/companion/"><link data-rh="true" rel="alternate" href="https://uppy.io/docs/companion/" hreflang="en"><link data-rh="true" rel="alternate" href="https://uppy.io/docs/companion/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://Q65IKQHNN5-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Uppy RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Uppy Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Uppy" href="/opensearch.xml">

<script src="https://analytics.transloadit.com/js/plausible.js" async defer="defer" data-domain="uppy.io"></script>
<script src="https://buttons.github.io/buttons.js" async defer="defer"></script><link rel="stylesheet" href="/assets/css/styles.ef55202d.css">
<script src="/assets/js/runtime~main.8d8c91fd.js" defer="defer"></script>
<script src="/assets/js/main.431e86b2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Uppy Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Uppy Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Uppy</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/quick-start/">Docs</a><a class="navbar__item navbar__link" href="/examples/">Examples</a><a class="navbar__item navbar__link" href="/blog/">Blog</a><a href="https://github.com/transloadit/uppy" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://community.transloadit.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://transloadit.com/open-source/support/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Support<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/quick-start/">Quick start</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/guides/choosing-uploader/">Guides</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/uppy/">Uppy core</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/companion/">Companion</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/dashboard/">User interfaces</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/webcam/">Sources</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/transloadit/">Uploaders</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/angular/">Framework integrations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/remote-sources/">Presets</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/locales/">Internationalisation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/golden-retriever/">Golden Retriever</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/compressor/">Compressor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/form/">Form</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Companion</h1>
<p>Companion is an open source server application which <strong>takes away the complexity
of authentication and the cost of downloading files from remote sources</strong>, such
as Instagram, Google Drive, and others. Companion is a server-to-server
orchestrator that streams files from a source to a destination, and files are
never stored in Companion. Companion can run either as a standalone
(self-hosted) application, <a href="#hosted">Transloadit-hosted</a>, or plugged in as an
Express middleware into an existing application. The Uppy client requests remote
files from Companion, which it will download and simultaneously upload to your
<a href="/docs/tus/">Tus server</a>, <a href="/docs/aws-s3/">AWS bucket</a>, or any server that supports
<a href="/docs/xhr-upload/">PUT, POST or Multipart uploads</a>.</p>
<p>This means a user uploading a 5GB video from Google Drive from their phone isn’t
eating into their data plans and you don’t have to worry about implementing
OAuth.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="when-should-i-use-it">When should I use it?<a href="#when-should-i-use-it" class="hash-link" aria-label="Direct link to When should I use it?" title="Direct link to When should I use it?">​</a></h2>
<p>If you want to let users download files from <a href="/docs/box/">Box</a>, <a href="/docs/dropbox/">Dropbox</a>, <a href="/docs/facebook/">Facebook</a>,
<a href="/docs/google-drive/">Google Drive</a>, <a href="/docs/instagram/">Instagram</a>, <a href="/docs/onedrive/">OneDrive</a>, <a href="/docs/unsplash/">Unsplash</a>, <a href="/docs/url/">Import
from URL</a>, or <a href="/docs/zoom/">Zoom</a> — you need Companion.</p>
<p>Companion supports the same <a href="/docs/guides/choosing-uploader/">uploaders</a> as Uppy:
<a href="/docs/tus/">Tus</a>, <a href="/docs/aws-s3/">AWS S3</a>, and <a href="/docs/tus/">regular multipart</a>.
But instead of manually setting a plugin, Uppy sends along a header with the
uploader and Companion will use the same on the server. This means if you are
using <a href="/docs/tus/">Tus</a> for your local uploads, you can send your remote uploads
to the same Tus server (and likewise for your AWS S3 bucket).</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Companion only deals with <em>remote</em> files, <em>local</em> files are still uploaded from
the client with your upload plugin.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hosted">Hosted<a href="#hosted" class="hash-link" aria-label="Direct link to Hosted" title="Direct link to Hosted">​</a></h2>
<p>Using <a href="https://transloadit.com" target="_blank" rel="noopener noreferrer">Transloadit</a> services comes with a hosted version of Companion so you
don’t have to worry about hosting your own server. Whether you are on a free or
paid Transloadit <a href="https://transloadit.com/pricing/" target="_blank" rel="noopener noreferrer">plan</a>, you can use
Companion. It’s not possible to rent a Companion server without a Transloadit
plan.</p>
<p><a href="https://transloadit.com/pricing/" target="_blank" rel="noopener noreferrer"><strong>Sign-up for a (free) plan</strong></a>.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Choosing Transloadit for your file services also comes with credentials for all
remote providers. This means you don’t have to waste time going through the
approval process of every app. You can still add your own credentials in the
Transloadit admin page if you want.</p></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Downloading and uploading files through Companion doesn’t count towards your
<a href="https://transloadit.com/docs/faq/1gb-worth/" target="_blank" rel="noopener noreferrer">monthly quota</a>, it’s a way for
files to arrive at Transloadit servers, much like Uppy.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="installation--use">Installation &amp; use<a href="#installation--use" class="hash-link" aria-label="Direct link to Installation &amp; use" title="Direct link to Installation &amp; use">​</a></h2>
<p>Companion is installed from npm. Depending on how you want to run Companion, the
install process is slightly different. Companion can be integrated as middleware
into your <a href="https://expressjs.com/" target="_blank" rel="noopener noreferrer">Express</a> app or as a standalone server.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm install @uppy/companion</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Since v2, you need to be running <code>node.js &gt;= v10.20.1</code> to use Companion. More
information in the <a href="/docs/guides/migrate-2.0/">migrating to 2.0</a> guide.</p><p>Windows is not a supported platform right now. It may work, and we’re happy to
accept improvements in this area, but we can’t provide support.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="express-middleware">Express middleware<a href="#express-middleware" class="hash-link" aria-label="Direct link to Express middleware" title="Direct link to Express middleware">​</a></h3>
<p>First install it into your Node.js project with your favorite package manager:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm install @uppy/companion</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To plug Companion into an existing server, call its <code>.app</code> method, passing in an
<a href="#options">options</a> object as a parameter. This returns a server instance that
you can mount on a route in your Express app.</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">express</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;express&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">bodyParser</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;body-parser&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">session</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;express-session&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">companion</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@uppy/companion&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">express</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Companion requires body-parser and express-session middleware.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// You can add it like this if you use those throughout your app.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// If you are using something else in your app, you can add these</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// middlewares in the same subpath as Companion instead.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bodyParser</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">session</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">secret</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;some secrety secret&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> options </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token literal-property property" style="color:#36acaa">providerOptions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token literal-property property" style="color:#36acaa">drive</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token literal-property property" style="color:#36acaa">key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;GOOGLE_DRIVE_KEY&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token literal-property property" style="color:#36acaa">secret</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;GOOGLE_DRIVE_SECRET&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token literal-property property" style="color:#36acaa">server</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token literal-property property" style="color:#36acaa">host</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;localhost:3020&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token literal-property property" style="color:#36acaa">protocol</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;http&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token comment" style="color:#999988;font-style:italic">// This MUST match the path you specify in `app.use()` below:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/companion&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token literal-property property" style="color:#36acaa">filePath</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/path/to/folder/&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">app</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> companionApp </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> companion</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">app</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">companionOptions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">companionApp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Companion uses WebSockets to communicate progress, errors, and successes to the
client. This is what Uppy listens to to update it’s internal state and UI.</p>
<p>Add the Companion WebSocket server using the <code>companion.socket</code> function:</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> server </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">PORT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">companion</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">socket</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If WebSockets fail for some reason Uppy and Companion will fallback to HTTP
polling.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="standalone">Standalone<a href="#standalone" class="hash-link" aria-label="Direct link to Standalone" title="Direct link to Standalone">​</a></h3>
<p>You can use the standalone version if you want to run Companion as it’s own Node
process. It’s a configured Express server with sessions, logging, and security
best practices. First you’ll typically want to install it globally:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm install -g @uppy/companion</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Standalone Companion will always serve HTTP (not HTTPS) and expects a reverse
proxy with SSL termination in front of it when running in production. See
<a href="#server"><code>COMPANION_PROTOCOL</code></a> for more information.</p>
<p>Companion ships with an executable file (<code>bin/companion</code>) which is the
standalone server. Unlike the middleware version, options are set via
environment variables.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Checkout <a href="#options">options</a> for the available options in JS and environment
variable formats.</p></div></div>
<p>You need at least these three to get started:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export COMPANION_SECRET=&quot;shh!Issa Secret!&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export COMPANION_DOMAIN=&quot;YOUR SERVER DOMAIN&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export COMPANION_DATADIR=&quot;PATH/TO/DOWNLOAD/DIRECTORY&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then run:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">companion</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can also pass in the path to your JSON config file, like so:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">companion --config /path/to/companion.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You may also want to run Companion in a process manager like
<a href="https://pm2.keymetrics.io/" target="_blank" rel="noopener noreferrer">PM2</a> to make sure it gets restarted on upon
crashing as well as allowing scaling to many instances.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="running-many-instances">Running many instances<a href="#running-many-instances" class="hash-link" aria-label="Direct link to Running many instances" title="Direct link to Running many instances">​</a></h3>
<p>We recommend running at least two instances in production, so that if the
Node.js event loop gets blocked by one or more requests (due to a bug or spike
in traffic), it doesn’t also block or slow down all other requests as well (as
Node.js is single threaded).</p>
<p>As an example for scale, one enterprise customer of Transloadit, who self-hosts
Companion to power an education service that is used by many universities
globally, deploys 7 Companion instances. Their earlier solution ran on 35
instances. In our general experience Companion will saturate network interface
cards before other resources on commodity virtual servers (<code>c5d.2xlarge</code> for
instance).</p>
<p>Your mileage may vary, so we recommend to add observability. You can let
Prometheus crawl the <code>/metrics</code> endpoint and graph that with Grafana for
instance.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="using-unique-endpoints">Using unique endpoints<a href="#using-unique-endpoints" class="hash-link" aria-label="Direct link to Using unique endpoints" title="Direct link to Using unique endpoints">​</a></h4>
<p>One option is to run many instances with each instance having its own unique
endpoint. This could be on separate ports, (sub)domain names, or IPs. With this
setup, you can either:</p>
<ol>
<li>Implement your own logic that will direct each upload to a specific Companion
endpoint by setting the <code>companionUrl</code> option</li>
<li>Setting the Companion option <code>COMPANION_SELF_ENDPOINT</code>. This option will
cause Companion to respond with a <code>i-am</code> HTTP header containing the value
from <code>COMPANION_SELF_ENDPOINT</code>. When Uppy’s sees this header, it will pin all
requests for the upload to this endpoint.</li>
</ol>
<p>In either case, you would then also typically configure a single Companion
instance (one endpoint) to handle all OAuth authentication requests, so that you
only need to specify a single OAuth callback URL. See also <code>oauthDomain</code> and
<code>validHosts</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="using-a-load-balancer">Using a load balancer<a href="#using-a-load-balancer" class="hash-link" aria-label="Direct link to Using a load balancer" title="Direct link to Using a load balancer">​</a></h4>
<p>The other option is to set up a load balancer in front of many Companion
instances. Then Uppy will only see a single endpoint and send all requests to
the associated load balancer, which will then distribute them between Companion
instances. The companion instances coordinate their messages and events over
Redis so that any instance can serve the client’s requests. Note that sticky
sessions are <strong>not</strong> needed with this setup. Here are the requirements for this
setup:</p>
<ul>
<li>The instances need to be connected to the same Redis server.</li>
<li>You need to set <code>COMPANION_SECRET</code> to the same value on both servers.</li>
<li>if you use the <code>companionKeysParams</code> feature (Transloadit), you also need
<code>COMPANION_PREAUTH_SECRET</code> to be the same on each instance.</li>
<li>All other configuration needs to be the same, except if you’re running many
instances on the same machine, then <code>COMPANION_PORT</code> should be different for
each instance.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="api">API<a href="#api" class="hash-link" aria-label="Direct link to API" title="Direct link to API">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="options">Options<a href="#options" class="hash-link" aria-label="Direct link to Options" title="Direct link to Options">​</a></h3>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The headings display the JS and environment variable options (<code>option</code>
<code>ENV_OPTION</code>). When integrating Companion into your own server, you pass the
options to <code>companion.app()</code>. If you are using the standalone version, you
configure Companion using environment variables. Some options only exist as
environment variables or only as a JS option.</p></div></div>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Default configuration</summary><div><div class="collapsibleContent_i85q">
  <!-- -->
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> options </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token literal-property property" style="color:#36acaa">server</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token literal-property property" style="color:#36acaa">protocol</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;http&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token literal-property property" style="color:#36acaa">providerOptions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token literal-property property" style="color:#36acaa">s3</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token literal-property property" style="color:#36acaa">endpoint</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://{service}.{region}.amazonaws.com&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token literal-property property" style="color:#36acaa">conditions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token literal-property property" style="color:#36acaa">useAccelerateEndpoint</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token function-variable function" style="color:#d73a49">getKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> filename</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">crypto</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation method function property-access" style="color:#d73a49">randomUUID</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">filename</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token literal-property property" style="color:#36acaa">expires</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">800</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// seconds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token literal-property property" style="color:#36acaa">allowLocalUrls</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token literal-property property" style="color:#36acaa">logClientVersion</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token literal-property property" style="color:#36acaa">periodicPingUrls</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token literal-property property" style="color:#36acaa">streamingUpload</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token literal-property property" style="color:#36acaa">clientSocketConnectTimeout</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token literal-property property" style="color:#36acaa">metrics</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</div></div></details>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="filepath-companion_datadir"><code>filePath</code> <code>COMPANION_DATADIR</code><a href="#filepath-companion_datadir" class="hash-link" aria-label="Direct link to filepath-companion_datadir" title="Direct link to filepath-companion_datadir">​</a></h4>
<p>Full path to the directory to which provider files will be downloaded
temporarily.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="secret-companion_secret-companion_secret_file"><code>secret</code> <code>COMPANION_SECRET</code> <code>COMPANION_SECRET_FILE</code><a href="#secret-companion_secret-companion_secret_file" class="hash-link" aria-label="Direct link to secret-companion_secret-companion_secret_file" title="Direct link to secret-companion_secret-companion_secret_file">​</a></h4>
<p>A secret string which Companion uses to generate authorization tokens. You
should generate a long random string for this. For example:</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> crypto </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;crypto&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> secret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> crypto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">randomBytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">64</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;hex&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>Omitting the <code>secret</code> in the standalone version will generate a secret for you,
using the above <code>crypto</code> string. But when integrating with Express you must
provide it yourself. This is an essential security measure.</p></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Using a secret file means passing an absolute path to a file with any extension,
which has only the secret, nothing else.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="preauthsecret-companion_preauth_secret-companion_preauth_secret_file"><code>preAuthSecret</code> <code>COMPANION_PREAUTH_SECRET</code> <code>COMPANION_PREAUTH_SECRET_FILE</code><a href="#preauthsecret-companion_preauth_secret-companion_preauth_secret_file" class="hash-link" aria-label="Direct link to preauthsecret-companion_preauth_secret-companion_preauth_secret_file" title="Direct link to preauthsecret-companion_preauth_secret-companion_preauth_secret_file">​</a></h4>
<p>If you are using the <a href="/docs/transloadit/">Transloadit</a> <code>companionKeysParams</code>
feature (Transloadit-hosted Companion using your own custom OAuth credentials),
set this variable to a strong randomly generated secret. See also
<code>COMPANION_SECRET</code> (but do not use the same secret!)</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Using a secret file means passing an absolute path to a file with any extension,
which has only the secret, nothing else.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="uploadurls-companion_upload_urls"><code>uploadUrls</code> <code>COMPANION_UPLOAD_URLS</code><a href="#uploadurls-companion_upload_urls" class="hash-link" aria-label="Direct link to uploadurls-companion_upload_urls" title="Direct link to uploadurls-companion_upload_urls">​</a></h4>
<p>An allowlist (array) of strings (exact URLs) or regular expressions. Companion
will only accept uploads to these URLs. This ensures that your Companion
instance is only allowed to upload to your trusted servers and prevents
<a href="https://en.wikipedia.org/wiki/Server-side_request_forgery" target="_blank" rel="noopener noreferrer">SSRF</a> attacks.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="companion_port"><code>COMPANION_PORT</code><a href="#companion_port" class="hash-link" aria-label="Direct link to companion_port" title="Direct link to companion_port">​</a></h4>
<p>The port on which to start the standalone server, defaults to 3020. This is a
standalone-only option.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="companion_cookie_domain"><code>COMPANION_COOKIE_DOMAIN</code><a href="#companion_cookie_domain" class="hash-link" aria-label="Direct link to companion_cookie_domain" title="Direct link to companion_cookie_domain">​</a></h4>
<p>Allows you to customize the domain of the cookies created for Express sessions.
This is a standalone-only option.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="companion_hide_welcome"><code>COMPANION_HIDE_WELCOME</code><a href="#companion_hide_welcome" class="hash-link" aria-label="Direct link to companion_hide_welcome" title="Direct link to companion_hide_welcome">​</a></h4>
<p>Setting this to <code>true</code> disables the welcome message shown at <code>/</code>. This is a
standalone-only option.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="redisurl-companion_redis_url"><code>redisUrl</code> <code>COMPANION_REDIS_URL</code><a href="#redisurl-companion_redis_url" class="hash-link" aria-label="Direct link to redisurl-companion_redis_url" title="Direct link to redisurl-companion_redis_url">​</a></h4>
<p>URL to running Redis server. This can be used to scale Companion horizontally
using many instances. See <a href="#how-to-scale-companion">How to scale Companion</a>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="companion_redis_express_session_prefix"><code>COMPANION_REDIS_EXPRESS_SESSION_PREFIX</code><a href="#companion_redis_express_session_prefix" class="hash-link" aria-label="Direct link to companion_redis_express_session_prefix" title="Direct link to companion_redis_express_session_prefix">​</a></h4>
<p>Set a custom prefix for redis keys created by
<a href="https://github.com/tj/connect-redis" target="_blank" rel="noopener noreferrer">connect-redis</a>. Defaults to <code>sess:</code>.
Sessions are used for storing authentication state and for allowing thumbnails
to be loaded by the browser via Companion. You might want to change this because
if you run a redis with many different apps in the same redis server, it’s hard
to know where <code>sess:</code> comes from and it might collide with other apps. <strong>Note:</strong>
in the future, we plan and changing the default to <code>companion:</code> and possibly
remove this option. This is a standalone-only option. See also
<code>COMPANION_REDIS_PUBSUB_SCOPE</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="redisoptions"><code>redisOptions</code><a href="#redisoptions" class="hash-link" aria-label="Direct link to redisoptions" title="Direct link to redisoptions">​</a></h4>
<p>An object of
<a href="https://www.npmjs.com/package/redis#options-object-properties" target="_blank" rel="noopener noreferrer">options supported by redis client</a>.
This option can be used in place of <code>redisUrl</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="redispubsubscope-companion_redis_pubsub_scope"><code>redisPubSubScope</code> <code>COMPANION_REDIS_PUBSUB_SCOPE</code><a href="#redispubsubscope-companion_redis_pubsub_scope" class="hash-link" aria-label="Direct link to redispubsubscope-companion_redis_pubsub_scope" title="Direct link to redispubsubscope-companion_redis_pubsub_scope">​</a></h4>
<p>Use a scope for the companion events at the Redis server. Setting this option
will prefix all events with the name provided and a colon. See also
<code>COMPANION_REDIS_EXPRESS_SESSION_PREFIX</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="server"><code>server</code><a href="#server" class="hash-link" aria-label="Direct link to server" title="Direct link to server">​</a></h4>
<p>Configuration options for the underlying server.</p>








































<table><thead><tr><th>Key / Environment variable</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>protocol</code> <code>COMPANION_PROTOCOL</code></td><td><code>http</code> or <code>https</code></td><td>Used to build a URL to reference the Companion instance itself, which is used for headers and cookies. Companion itself always runs as a HTTP server, so locally you should use <code>http</code>. You must to set this to <code>https</code> once you enabled SSL/HTTPS for your domain in production by running a reverse https-proxy in front of Companion, or with a built-in HTTPS feature of your hosting service.</td></tr><tr><td><code>host</code> <code>COMPANION_DOMAIN</code></td><td><code>String</code></td><td>Your server’s publicly facing hostname (for example <code>example.com</code>).</td></tr><tr><td><code>oauthDomain</code> <code>COMPANION_OAUTH_DOMAIN</code></td><td><code>String</code></td><td>If you have several instances of Companion with different (and perhaps dynamic) subdomains, you can set a single fixed subdomain and server (such as <code>sub1.example.com</code>) to handle your OAuth authentication for you. This would then redirect back to the correct instance with the required credentials on completion. This way you only need to configure a single callback URL for OAuth providers.</td></tr><tr><td><code>path</code> <code>COMPANION_PATH</code></td><td><code>String</code></td><td>The server path to where the Companion app is sitting. For instance, if Companion is at <code>example.com/companion</code>, then the path would be <code>/companion</code>).</td></tr><tr><td><code>implicitPath</code> <code>COMPANION_IMPLICIT_PATH</code></td><td><code>String</code></td><td>If the URL’s path in your reverse proxy is different from your Companion path in your express app, then you need to set this path as <code>implicitPath</code>. For instance, if your Companion URL is <code>example.com/mypath/companion</code>. Where the path <code>/mypath</code> is defined in your NGINX server, while <code>/companion</code> is set in your express app. Then you need to set the option <code>implicitPath</code> to <code>/mypath</code>, and set the <code>path</code> option to <code>/companion</code>.</td></tr><tr><td><code>validHosts</code> <code>COMPANION_DOMAINS</code></td><td><code>Array</code></td><td>If you are setting an <code>oauthDomain</code>, you need to set a list of valid hosts, so the oauth handler can validate the host of the Uppy instance requesting the authentication. This is essentially a list of valid domains running your Companion instances. The list may also contain regex patterns. e.g <code>[&#x27;sub2.example.com&#x27;, &#x27;sub3.example.com&#x27;, &#x27;(\\w+).example.com&#x27;]</code></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="sendselfendpoint-companion_self_endpoint"><code>sendSelfEndpoint</code> <code>COMPANION_SELF_ENDPOINT</code><a href="#sendselfendpoint-companion_self_endpoint" class="hash-link" aria-label="Direct link to sendselfendpoint-companion_self_endpoint" title="Direct link to sendselfendpoint-companion_self_endpoint">​</a></h4>
<p>This is essentially the same as the <code>server.host + server.path</code> attributes. The
major reason for this attribute is that, when set, it adds the value as the
<code>i-am</code> header of every request response.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="provideroptions"><code>providerOptions</code><a href="#provideroptions" class="hash-link" aria-label="Direct link to provideroptions" title="Direct link to provideroptions">​</a></h4>
<p>Object to enable providers with their keys and secrets. For example:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	&quot;drive&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		&quot;key&quot;: &quot;***&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		&quot;secret&quot;: &quot;***&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When using the standalone version you use the corresponding environment
variables or point to a secret file (such as <code>COMPANION_GOOGLE_SECRET_FILE</code>).</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Secret files need an absolute path to a file with any extension which only has
the secret, nothing else.</p></div></div>













































<table><thead><tr><th>Service</th><th>Key</th><th>Environment variables</th></tr></thead><tbody><tr><td>Box</td><td><code>box</code></td><td><code>COMPANION_BOX_KEY</code>, <code>COMPANION_BOX_SECRET</code>, <code>COMPANION_BOX_SECRET_FILE</code></td></tr><tr><td>Dropbox</td><td><code>dropbox</code></td><td><code>COMPANION_DROPBOX_KEY</code>, <code>COMPANION_DROPBOX_SECRET</code>, <code>COMPANION_DROPBOX_SECRET_FILE</code></td></tr><tr><td>Facebook</td><td><code>facebook</code></td><td><code>COMPANION_FACEBOOK_KEY</code>, <code>COMPANION_FACEBOOK_SECRET</code>, <code>COMPANION_FACEBOOK_SECRET_FILE</code></td></tr><tr><td>Google Drive</td><td><code>drive</code></td><td><code>COMPANION_GOOGLE_KEY</code>, <code>COMPANION_GOOGLE_SECRET</code>, <code>COMPANION_GOOGLE_SECRET_FILE</code></td></tr><tr><td>Instagram</td><td><code>instagram</code></td><td><code>COMPANION_INSTAGRAM_KEY</code>, <code>COMPANION_INSTAGRAM_SECRET</code>, <code>COMPANION_INSTAGRAM_SECRET_FILE</code></td></tr><tr><td>OneDrive</td><td><code>onedrive</code></td><td><code>COMPANION_ONEDRIVE_KEY</code>, <code>COMPANION_ONEDRIVE_SECRET</code>, <code>COMPANION_ONEDRIVE_SECRET_FILE</code>, <code>COMPANION_ONEDRIVE_DOMAIN_VALIDATION</code> (Settings this variable to <code>true</code> enables a route that can be used to validate your app with OneDrive)</td></tr><tr><td>Zoom</td><td><code>zoom</code></td><td><code>COMPANION_ZOOM_KEY</code>, <code>COMPANION_ZOOM_SECRET</code>, <code>COMPANION_ZOOM_SECRET_FILE</code>, <code>COMPANION_ZOOM_VERIFICATION_TOKEN</code></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="s3"><code>s3</code><a href="#s3" class="hash-link" aria-label="Direct link to s3" title="Direct link to s3">​</a></h4>
<p>Companion comes with signature endpoints for AWS S3. These can be used by the
Uppy client to sign requests to upload files directly to S3, without exposing
secret S3 keys in the browser. Companion also supports uploading files from
providers like Dropbox and Instagram directly into S3.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="s3key-companion_aws_key"><code>s3.key</code> <code>COMPANION_AWS_KEY</code><a href="#s3key-companion_aws_key" class="hash-link" aria-label="Direct link to s3key-companion_aws_key" title="Direct link to s3key-companion_aws_key">​</a></h5>
<p>The S3 access key ID.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="s3secret-companion_aws_secret-companion_aws_secret_file"><code>s3.secret</code> <code>COMPANION_AWS_SECRET</code> <code>COMPANION_AWS_SECRET_FILE</code><a href="#s3secret-companion_aws_secret-companion_aws_secret_file" class="hash-link" aria-label="Direct link to s3secret-companion_aws_secret-companion_aws_secret_file" title="Direct link to s3secret-companion_aws_secret-companion_aws_secret_file">​</a></h5>
<p>The S3 secret access key.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Using a secret file means passing an absolute path to a file with any extension,
which has only the secret, nothing else.</p></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="s3endpoint-companion_aws_endpoint"><code>s3.endpoint</code> <code>COMPANION_AWS_ENDPOINT</code><a href="#s3endpoint-companion_aws_endpoint" class="hash-link" aria-label="Direct link to s3endpoint-companion_aws_endpoint" title="Direct link to s3endpoint-companion_aws_endpoint">​</a></h5>
<p>Optional URL to a custom S3 (compatible) service. Otherwise uses the default
from the AWS SDK.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="s3bucket-companion_aws_bucket"><code>s3.bucket</code> <code>COMPANION_AWS_BUCKET</code><a href="#s3bucket-companion_aws_bucket" class="hash-link" aria-label="Direct link to s3bucket-companion_aws_bucket" title="Direct link to s3bucket-companion_aws_bucket">​</a></h5>
<p>The name of the bucket to store uploaded files in.</p>
<p>It can be function that returns the name of the bucket as a <code>string</code> and takes
the following arguments:</p>
<ul>
<li><a href="https://nodejs.org/api/http.html#class-httpincomingmessage" target="_blank" rel="noopener noreferrer"><code>http.IncomingMessage</code></a>, the HTTP request (will be <code>null</code> for remote
uploads)</li>
<li>metadata provided by the user for the file (will be <code>undefined</code> for local
uploads)</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="s3region-companion_aws_region"><code>s3.region</code> <code>COMPANION_AWS_REGION</code><a href="#s3region-companion_aws_region" class="hash-link" aria-label="Direct link to s3region-companion_aws_region" title="Direct link to s3region-companion_aws_region">​</a></h5>
<p>The datacenter region where the target bucket is located.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="companion_aws_prefix"><code>COMPANION_AWS_PREFIX</code><a href="#companion_aws_prefix" class="hash-link" aria-label="Direct link to companion_aws_prefix" title="Direct link to companion_aws_prefix">​</a></h5>
<p>An optional prefix for all uploaded keys. This is a standalone-only option. The
same can be achieved by the <code>getKey</code> option when using the express middleware.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="s3awsclientoptions"><code>s3.awsClientOptions</code><a href="#s3awsclientoptions" class="hash-link" aria-label="Direct link to s3awsclientoptions" title="Direct link to s3awsclientoptions">​</a></h5>
<p>You can supply any
<a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/S3.html#constructor-property" target="_blank" rel="noopener noreferrer">S3 option supported by the AWS SDK</a>
in the <code>providerOptions.s3.awsClientOptions</code> object, <em>except for</em> the below:</p>
<ul>
<li><code>accessKeyId</code>. Instead, use the <code>providerOptions.s3.key</code> property. This is to
make configuration names consistent between different Companion features.</li>
<li><code>secretAccessKey</code>. Instead, use the <code>providerOptions.s3.secret</code> property. This
is to make configuration names consistent between different Companion
features.</li>
</ul>
<p>Be aware that some options may cause wrong behaviour if they conflict with
Companion’s assumptions. If you find that a particular option does not work as
expected, please
<a href="https://github.com/transloadit/uppy/issues/new" target="_blank" rel="noopener noreferrer">open an issue on the Uppy repository</a>
so we can document it here.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="s3getkeyreq-filename-metadata"><code>s3.getKey(req, filename, metadata)</code><a href="#s3getkeyreq-filename-metadata" class="hash-link" aria-label="Direct link to s3getkeyreq-filename-metadata" title="Direct link to s3getkeyreq-filename-metadata">​</a></h5>
<p>Get the key name for a file. The key is the file path to which the file will be
uploaded in your bucket. This option should be a function receiving three
arguments:</p>
<ul>
<li><code>req</code> <a href="https://nodejs.org/api/http.html#class-httpincomingmessage" target="_blank" rel="noopener noreferrer"><code>http.IncomingMessage</code></a>, the HTTP request, for <em>regular</em> S3 uploads
using the <code>@uppy/aws-s3</code> plugin. This parameter is <em>not</em> available for
multipart uploads using the <code>@uppy/aws-s3</code> or <code>@uppy/aws-s3-multipart</code>
plugins. This parameter is <code>null</code> for remote uploads.</li>
<li><code>filename</code>, the original name of the uploaded file;</li>
<li><code>metadata</code>, user-provided metadata for the file.</li>
</ul>
<p>This function should return a string <code>key</code>. The <code>req</code> parameter can be used to
upload to a user-specific folder in your bucket, for example:</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">authenticationMiddleware</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	uppy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">app</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token literal-property property" style="color:#36acaa">providerOptions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token literal-property property" style="color:#36acaa">s3</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token function-variable function" style="color:#d73a49">getKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> filename</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> metadata</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">req</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">user</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">id</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">filename</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token comment" style="color:#999988;font-style:italic">/* auth options */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The default implementation returns the <code>filename</code>, so all files will be uploaded
to the root of the bucket as their original file name.</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	uppy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">app</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token literal-property property" style="color:#36acaa">providerOptions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token literal-property property" style="color:#36acaa">s3</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token function-variable function" style="color:#d73a49">getKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> filename</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> metadata</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> filename</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When signing on the client, this function will only be called for multipart
uploads.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="companion_aws_use_accelerate_endpoint"><code>COMPANION_AWS_USE_ACCELERATE_ENDPOINT</code><a href="#companion_aws_use_accelerate_endpoint" class="hash-link" aria-label="Direct link to companion_aws_use_accelerate_endpoint" title="Direct link to companion_aws_use_accelerate_endpoint">​</a></h4>
<p>Enable S3
<a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/transfer-acceleration.html" target="_blank" rel="noopener noreferrer">Transfer Acceleration</a>.
This is a standalone-only option.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="companion_aws_expires"><code>COMPANION_AWS_EXPIRES</code><a href="#companion_aws_expires" class="hash-link" aria-label="Direct link to companion_aws_expires" title="Direct link to companion_aws_expires">​</a></h4>
<p>Set <code>X-Amz-Expires</code> query parameter in the presigned urls (in seconds, default:
300). This is a standalone-only option.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="companion_aws_acl"><code>COMPANION_AWS_ACL</code><a href="#companion_aws_acl" class="hash-link" aria-label="Direct link to companion_aws_acl" title="Direct link to companion_aws_acl">​</a></h4>
<p>Set a
<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html#canned-acl" target="_blank" rel="noopener noreferrer">Canned ACL</a>
for uploaded objects. This is a standalone-only option.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="customproviders"><code>customProviders</code><a href="#customproviders" class="hash-link" aria-label="Direct link to customproviders" title="Direct link to customproviders">​</a></h4>
<p>This option enables you to add custom providers along with the already supported
providers. See <a href="#how-to-add-custom-providers">adding custom providers</a> for more
information.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="logclientversion"><code>logClientVersion</code><a href="#logclientversion" class="hash-link" aria-label="Direct link to logclientversion" title="Direct link to logclientversion">​</a></h4>
<p>A boolean flag to tell Companion whether to log its version upon startup.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="metrics-companion_hide_metrics"><code>metrics</code> <code>COMPANION_HIDE_METRICS</code><a href="#metrics-companion_hide_metrics" class="hash-link" aria-label="Direct link to metrics-companion_hide_metrics" title="Direct link to metrics-companion_hide_metrics">​</a></h4>
<p>A boolean flag to tell Companion whether to provide an endpoint <code>/metrics</code> with
Prometheus metrics (by default metrics are enabled.)</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="streamingupload-companion_streaming_upload"><code>streamingUpload</code> <code>COMPANION_STREAMING_UPLOAD</code><a href="#streamingupload-companion_streaming_upload" class="hash-link" aria-label="Direct link to streamingupload-companion_streaming_upload" title="Direct link to streamingupload-companion_streaming_upload">​</a></h4>
<p>A boolean flag to tell Companion whether to enable streaming uploads. If
enabled, it will lead to <em>faster uploads</em> because companion will start uploading
at the same time as downloading using <code>stream.pipe</code>. If <code>false</code>, files will be
fully downloaded first, then uploaded. Defaults to <code>false</code>, but we recommended
enabling it, especially if you’re expecting to upload large files. In future
versions the default might change to <code>true</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="maxfilesize-companion_max_file_size"><code>maxFileSize</code> <code>COMPANION_MAX_FILE_SIZE</code><a href="#maxfilesize-companion_max_file_size" class="hash-link" aria-label="Direct link to maxfilesize-companion_max_file_size" title="Direct link to maxfilesize-companion_max_file_size">​</a></h4>
<p>If this value is set, companion will limit the maximum file size to process. If
unset, it will process files without any size limit (this is the default).</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="periodicpingurls-companion_periodic_ping_urls"><code>periodicPingUrls</code> <code>COMPANION_PERIODIC_PING_URLS</code><a href="#periodicpingurls-companion_periodic_ping_urls" class="hash-link" aria-label="Direct link to periodicpingurls-companion_periodic_ping_urls" title="Direct link to periodicpingurls-companion_periodic_ping_urls">​</a></h4>
<p>If this value is set, companion will periodically send POST requests to the
specified URLs. Useful for keeping track of companion instances as a keep-alive.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="periodicpinginterval-companion_periodic_ping_interval"><code>periodicPingInterval</code> <code>COMPANION_PERIODIC_PING_INTERVAL</code><a href="#periodicpinginterval-companion_periodic_ping_interval" class="hash-link" aria-label="Direct link to periodicpinginterval-companion_periodic_ping_interval" title="Direct link to periodicpinginterval-companion_periodic_ping_interval">​</a></h4>
<p>Interval for periodic ping requests (in ms).</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="periodicpingstaticpayload-companion_periodic_ping_static_json_payload"><code>periodicPingStaticPayload</code> <code>COMPANION_PERIODIC_PING_STATIC_JSON_PAYLOAD</code><a href="#periodicpingstaticpayload-companion_periodic_ping_static_json_payload" class="hash-link" aria-label="Direct link to periodicpingstaticpayload-companion_periodic_ping_static_json_payload" title="Direct link to periodicpingstaticpayload-companion_periodic_ping_static_json_payload">​</a></h4>
<p>A <code>JSON.stringify</code>-able JavaScript Object that will be sent as part of the JSON
body in the period ping requests.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="allowlocalurls-companion_allow_local_urls"><code>allowLocalUrls</code> <code>COMPANION_ALLOW_LOCAL_URLS</code><a href="#allowlocalurls-companion_allow_local_urls" class="hash-link" aria-label="Direct link to allowlocalurls-companion_allow_local_urls" title="Direct link to allowlocalurls-companion_allow_local_urls">​</a></h4>
<p>A boolean flag to tell Companion whether to allow requesting local URLs
(non-internet IPs).</p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>Only enable this in development. <strong>Enabling it in production is a security
risk.</strong></p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="corsorigins-companion_client_origins"><code>corsOrigins</code> <code>COMPANION_CLIENT_ORIGINS</code><a href="#corsorigins-companion_client_origins" class="hash-link" aria-label="Direct link to corsorigins-companion_client_origins" title="Direct link to corsorigins-companion_client_origins">​</a></h4>
<p>Allowed CORS Origins (default <code>true</code>). Passed as the <code>origin</code> option in
<a href="https://github.com/expressjs/cors#configuration-options" target="_blank" rel="noopener noreferrer">cors</a>)</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="companion_client_origins_regex"><code>COMPANION_CLIENT_ORIGINS_REGEX</code><a href="#companion_client_origins_regex" class="hash-link" aria-label="Direct link to companion_client_origins_regex" title="Direct link to companion_client_origins_regex">​</a></h4>
<p>Like COMPANION_CLIENT_ORIGINS, but allows a single regex instead.
<code>COMPANION_CLIENT_ORIGINS</code> will be ignored if this is used. This is a
standalone-only option.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="chunksize-companion_chunk_size"><code>chunkSize</code> <code>COMPANION_CHUNK_SIZE</code><a href="#chunksize-companion_chunk_size" class="hash-link" aria-label="Direct link to chunksize-companion_chunk_size" title="Direct link to chunksize-companion_chunk_size">​</a></h4>
<p>Controls how big the uploaded chunks are for AWS S3 Multipart and Tus. Smaller
values lead to more overhead, but larger values lead to slower retries in case
of bad network connections. Passed to tus-js-client
<a href="https://github.com/tus/tus-js-client/blob/master/docs/api.md#chunksize" target="_blank" rel="noopener noreferrer"><code>chunkSize</code></a>
as well as
<a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/S3.html" target="_blank" rel="noopener noreferrer">AWS S3 Multipart</a>
<code>partSize</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="enableurlendpoint-companion_enable_url_endpoint"><code>enableUrlEndpoint</code> <code>COMPANION_ENABLE_URL_ENDPOINT</code><a href="#enableurlendpoint-companion_enable_url_endpoint" class="hash-link" aria-label="Direct link to enableurlendpoint-companion_enable_url_endpoint" title="Direct link to enableurlendpoint-companion_enable_url_endpoint">​</a></h4>
<p>Set this to <code>false</code> to disable the
<a href="https://uppy.io/docs/url/" target="_blank" rel="noopener noreferrer">URL functionalily</a>. Default: <code>true</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="events">Events<a href="#events" class="hash-link" aria-label="Direct link to Events" title="Direct link to Events">​</a></h3>
<p>The object returned by <code>companion.app()</code> also has a property <code>companionEmitter</code>
which is an <code>EventEmitter</code> that emits the following events:</p>
<ul>
<li><code>upload-start</code> - When an upload starts, this event is emitted with an object
containing the property <code>token</code>, which is a unique ID for the upload.</li>
<li><strong>token</strong> - The event name is the token from <code>upload-start</code>. The event has an
object with the following properties:
<ul>
<li><code>action</code> - One of the following strings:
<ul>
<li><code>success</code> - When the upload succeeds.</li>
<li><code>error</code> - When the upload fails with an error.</li>
</ul>
</li>
<li><code>payload</code> - the error or success payload.</li>
</ul>
</li>
</ul>
<p>Example code for using the <code>EventEmitter</code> to handle a finished file upload:</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> companionApp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> companion</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">app</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">companionEmitter</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> emitter </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> companionApp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">emitter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;upload-start&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter"> token </span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Upload started&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onUploadEvent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter"> action</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> payload </span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">action </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;success&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			emitter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">off</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> onUploadEvent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// avoid listener leak</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Upload finished&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">action </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;error&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			emitter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">off</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> onUploadEvent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// avoid listener leak</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Upload failed&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	emitter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> onUploadEvent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="frequently-asked-questions">Frequently asked questions<a href="#frequently-asked-questions" class="hash-link" aria-label="Direct link to Frequently asked questions" title="Direct link to Frequently asked questions">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="do-you-have-a-live-example">Do you have a live example?<a href="#do-you-have-a-live-example" class="hash-link" aria-label="Direct link to Do you have a live example?" title="Direct link to Do you have a live example?">​</a></h3>
<p>An example server is running at <a href="https://companion.uppy.io" target="_blank" rel="noopener noreferrer">https://companion.uppy.io</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-does-the-authentication-and-token-mechanism-work">How does the Authentication and Token mechanism work?<a href="#how-does-the-authentication-and-token-mechanism-work" class="hash-link" aria-label="Direct link to How does the Authentication and Token mechanism work?" title="Direct link to How does the Authentication and Token mechanism work?">​</a></h3>
<p>This section describes how Authentication works between Companion and Providers.
While this behaviour is the same for all Providers (Dropbox, Instagram, Google
Drive, etc.), we are going to be referring to Dropbox in place of any Provider
throughout this section.</p>
<p>The following steps describe the actions that take place when a user
Authenticates and Uploads from Dropbox through Companion:</p>
<ul>
<li>The visitor to a website with Uppy clicks <code>Connect to Dropbox</code>.</li>
<li>Uppy sends a request to Companion, which in turn sends an OAuth request to
Dropbox (Requires that OAuth credentials from Dropbox have been added to
Companion).</li>
<li>Dropbox asks the visitor to log in, and whether the Website should be allowed
to access your files</li>
<li>If the visitor agrees, Companion will receive a token from Dropbox, with which
we can temporarily download files.</li>
<li>Companion encrypts the token with a secret key and sends the encrypted token
to Uppy (client)</li>
<li>Every time the visitor clicks on a folder in Uppy, it asks Companion for the
new list of files, with this question, the token (still encrypted by
Companion) is sent along.</li>
<li>Companion decrypts the token, requests the list of files from Dropbox and
sends it to Uppy.</li>
<li>When a file is selected for upload, Companion receives the token again
according to this procedure, decrypts it again, and thereby downloads the file
from Dropbox.</li>
<li>As the bytes arrive, Companion uploads the bytes to the final destination
(depending on the configuration: Apache, a Tus server, S3 bucket, etc).</li>
<li>Companion reports progress to Uppy, as if it were a local upload.</li>
<li>Completed!</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-use-provider-redirect-uris">How to use provider redirect URIs?<a href="#how-to-use-provider-redirect-uris" class="hash-link" aria-label="Direct link to How to use provider redirect URIs?" title="Direct link to How to use provider redirect URIs?">​</a></h3>
<p>When generating your provider API keys on their corresponding developer
platforms (e.g
<a href="https://console.developers.google.com/" target="_blank" rel="noopener noreferrer">Google Developer Console</a>), you’d need
to provide a <code>redirect URI</code> for the OAuth authorization process. In general the
redirect URI for each provider takes the format:</p>
<p><code>http(s)://$YOUR_COMPANION_HOST_NAME/$PROVIDER_NAME/redirect</code></p>
<p>For example, if your Companion server is hosted on
<code>https://my.companion.server.com</code>, then the redirect URI you would supply for
your OneDrive provider would be:</p>
<p><code>https://my.companion.server.com/onedrive/redirect</code></p>
<p>Please see
<a href="https://uppy.io/docs/companion/#Supported-providers" target="_blank" rel="noopener noreferrer">Supported Providers</a> for a
list of all Providers and their corresponding names.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-use-companion-with-kubernetes">How to use Companion with Kubernetes?<a href="#how-to-use-companion-with-kubernetes" class="hash-link" aria-label="Direct link to How to use Companion with Kubernetes?" title="Direct link to How to use Companion with Kubernetes?">​</a></h3>
<p>We have a detailed
<a href="https://github.com/transloadit/uppy/blob/main/packages/%40uppy/companion/KUBERNETES.md" target="_blank" rel="noopener noreferrer">guide</a>
on running Companion in Kubernetes.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-add-custom-providers">How to add custom providers?<a href="#how-to-add-custom-providers" class="hash-link" aria-label="Direct link to How to add custom providers?" title="Direct link to How to add custom providers?">​</a></h3>
<p>As of now, Companion supports the
<a href="https://uppy.io/docs/companion/#Supported-providers" target="_blank" rel="noopener noreferrer">providers listed here</a> out
of the box, but you may also choose to add your own custom providers. You can do
this by passing the <code>customProviders</code> option when calling the Uppy <code>app</code> method.
The custom provider is expected to support Oauth 1 or 2 for
authentication/authorization.</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">providerModule</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./path/to/provider/module&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> options </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token literal-property property" style="color:#36acaa">customProviders</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token literal-property property" style="color:#36acaa">myprovidername</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token literal-property property" style="color:#36acaa">config</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#36acaa">authorize_url</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://mywebsite.com/authorize&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#36acaa">access_url</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://mywebsite.com/token&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#36acaa">oauth</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#36acaa">key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;***&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#36acaa">secret</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;***&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#36acaa">scope</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;read&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;write&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token literal-property property" style="color:#36acaa">module</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> providerModule</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uppy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">app</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>customProviders</code> option should be an object containing each custom
provider. Each custom provider would, in turn, be an object with two keys,
<code>config</code> and <code>module</code>. The <code>config</code> option would contain Oauth API settings,
while the <code>module</code> would point to the provider module.</p>
<p>To work well with Companion, the <strong>module</strong> must be a class with the following
methods. Note that the methods must be <code>async</code>, return a <code>Promise</code> or reject
with an <code>Error</code>):</p>
<ol>
<li><code>async list ({ token, directory, query })</code> - Returns a object containing a
list of user files (such as a list of all the files in a particular
directory). See <a href="#list-data">example returned list data structure</a>. <code>token</code> -
authorization token (retrieved from oauth process) to send along with your
request
<ul>
<li><code>directory</code> - the id/name of the directory from which data is to be
retrieved. This may be ignored if it doesn’t apply to your provider</li>
<li><code>query</code> - expressjs query params object received by the server (in case
some data you need in there).</li>
</ul>
</li>
<li><code>async download ({ token, id, query })</code> - Downloads a particular file from
the provider. Returns an object with a single property <code>{ stream }</code> - a
<a href="https://nodejs.org/api/stream.html#stream_class_stream_readable" target="_blank" rel="noopener noreferrer"><code>stream.Readable</code></a>,
which will be read from and uploaded to the destination. To prevent memory
leaks, make sure you release your stream if you reject this method with an
error.
<ul>
<li><code>token</code> - authorization token (retrieved from oauth process) to send along
with your request.</li>
<li><code>id</code> - ID of the file being downloaded.</li>
<li><code>query</code> - expressjs query params object received by the server (in case
some data you need in there).</li>
</ul>
</li>
<li><code>async size ({ token, id, query })</code> - Returns the byte size of the file that
needs to be downloaded as a <code>Number</code>. If the size of the object is not known,
<code>null</code> may be returned.
<ul>
<li><code>token</code> - authorization token (retrieved from oauth process) to send along
with your request.</li>
<li><code>id</code> - ID of the file being downloaded.</li>
<li><code>query</code> - expressjs query params object received by the server (in case
some data you need in there).</li>
</ul>
</li>
</ol>
<p>The class must also have:</p>
<ul>
<li>A unique <code>static authProvider</code> string property - a lowercased value which
typically indicates the name of the provider (e.g “dropbox”).</li>
<li>A <code>static</code> property <code>static version = 2</code>, which is the current version of the
Companion Provider API.</li>
</ul>
<p>See also
<a href="https://github.com/transloadit/uppy/blob/main/examples/custom-provider/server" target="_blank" rel="noopener noreferrer">example code with a custom provider</a>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="list-data">list data<a href="#list-data" class="hash-link" aria-label="Direct link to list data" title="Direct link to list data">​</a></h4>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// username or email of the user whose provider account is being accessed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	&quot;username&quot;: &quot;johndoe&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// list of files and folders in the directory. An item is considered a folder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	//  if it mainly exists as a collection to contain sub-items</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	&quot;items&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			// boolean value of whether or NOT it&#x27;s a folder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&quot;isFolder&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			// icon image URL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&quot;icon&quot;: &quot;https://random-api.url.com/fileicon.jpg&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			// name of the item</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&quot;name&quot;: &quot;myfile.jpg&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			// the mime type of the item. Only relevant if the item is NOT a folder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&quot;mimeType&quot;: &quot;image/jpg&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			// the id (in string) of the item</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&quot;id&quot;: &quot;uniqueitemid&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			// thumbnail image URL. Only relevant if the item is NOT a folder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&quot;thumbnail&quot;: &quot;https://random-api.url.com/filethumbnail.jpg&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			// for folders this is typically the value that will be passed as &quot;directory&quot; in the list(...) method.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			// For files, this is the value that will be passed as id in the download(...) method.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&quot;requestPath&quot;: &quot;file-or-folder-requestpath&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			// datetime string (in ISO 8601 format) of when this item was last modified</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&quot;modifiedDate&quot;: &quot;2020-06-29T19:59:58Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			// the size in bytes of the item. Only relevant if the item is NOT a folder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&quot;size&quot;: 278940,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&quot;custom&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				// an object that may contain some more custom fields that you may need to send to the client. Only add this object if you have a need for it.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				&quot;customData1&quot;: &quot;the value&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				&quot;customData2&quot;: &quot;the value&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			// more items here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// if the &quot;items&quot; list is paginated, this is the request path needed to fetch the next page.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	&quot;nextPagePath&quot;: &quot;directory-name?cursor=cursor-to-next-page&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-run-companion-locally">How to run Companion locally?<a href="#how-to-run-companion-locally" class="hash-link" aria-label="Direct link to How to run Companion locally?" title="Direct link to How to run Companion locally?">​</a></h3>
<ol>
<li>
<p>To set up Companion for local development, please clone the Uppy repo and
install, like so:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/transloadit/uppy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd uppy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yarn install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Configure your environment variables by copying the <code>env.example.sh</code> file to
<code>env.sh</code> and edit it to its correct values.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cp .env.example .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$EDITOR .env</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>To start the server, run:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yarn run start:companion</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<p>This would get the Companion instance running on <code>http://localhost:3020</code>. It
uses <a href="https://github.com/remy/nodemon" target="_blank" rel="noopener noreferrer">nodemon</a> so it will automatically restart
when files are changed.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/transloadit/uppy.io/tree/main/docs/companion.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/uppy/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Uppy core</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/dashboard/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Dashboard</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#when-should-i-use-it" class="table-of-contents__link toc-highlight">When should I use it?</a></li><li><a href="#hosted" class="table-of-contents__link toc-highlight">Hosted</a></li><li><a href="#installation--use" class="table-of-contents__link toc-highlight">Installation &amp; use</a><ul><li><a href="#express-middleware" class="table-of-contents__link toc-highlight">Express middleware</a></li><li><a href="#standalone" class="table-of-contents__link toc-highlight">Standalone</a></li><li><a href="#running-many-instances" class="table-of-contents__link toc-highlight">Running many instances</a></li></ul></li><li><a href="#api" class="table-of-contents__link toc-highlight">API</a><ul><li><a href="#options" class="table-of-contents__link toc-highlight">Options</a></li><li><a href="#events" class="table-of-contents__link toc-highlight">Events</a></li></ul></li><li><a href="#frequently-asked-questions" class="table-of-contents__link toc-highlight">Frequently asked questions</a><ul><li><a href="#do-you-have-a-live-example" class="table-of-contents__link toc-highlight">Do you have a live example?</a></li><li><a href="#how-does-the-authentication-and-token-mechanism-work" class="table-of-contents__link toc-highlight">How does the Authentication and Token mechanism work?</a></li><li><a href="#how-to-use-provider-redirect-uris" class="table-of-contents__link toc-highlight">How to use provider redirect URIs?</a></li><li><a href="#how-to-use-companion-with-kubernetes" class="table-of-contents__link toc-highlight">How to use Companion with Kubernetes?</a></li><li><a href="#how-to-add-custom-providers" class="table-of-contents__link toc-highlight">How to add custom providers?</a></li><li><a href="#how-to-run-companion-locally" class="table-of-contents__link toc-highlight">How to run Companion locally?</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer_J6tW"><p><img class="IndexFooter-logo" title="Uppy" alt="Uppy" src="/img/logo.svg"></p><p>Released under the<!-- --> <a href="http://opensource.org/licenses/MIT" rel="noreferrer noopener" target="_blank">MIT License</a> <!-- -->⋅ <a href="/privacy-policy/">Privacy Policy</a> ⋅<!-- --> <a href="https://github.com/transloadit/uppy/blob/main/.github/CONTRIBUTING.md">Contributing</a></p><p>© 2023<!-- --> <a href="https://transloadit.com" target="_blank">Transloadit</a></p></footer></div>
</body>
</html>